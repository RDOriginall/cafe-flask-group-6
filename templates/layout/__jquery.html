<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function addToOrder(elem) {
        let inputs = $(elem).prevAll()
        let _id = inputs[3].value
        let name = inputs[2].value
        let price = inputs[1].value
        let number = Number(inputs[0].value)
        if ($(`#order-item-${_id}`).length) {
            let itemNumber = Number($(`#order-item-${_id}`).find('.item-number').text())
            if ((number + itemNumber) <= 10) {
                $(`#order-item-${_id}`).find('.item-number').text(itemNumber + number)
            } else {
                $(`#order-item-${_id}`).find('.item-number').text(10)
            }
        } else {
            let item = $("#items-in-modal").clone().attr("id", `order-item-${_id}`)
            $(item).find('.item-name').append(`${name}`)
            $(item).find('.item-price').append(`${price * number}`)
            $(item).find('.item-price-input').val(`${price * number}`)
            $(item).find('.item-price-constant').append(`${price}`)
            $(item).find('.item-number').append(`${number}`)
            $(item).appendTo("#order-modal-body")
            totalPrice()
        }
    }

    function minusButton(button) {
        let elem = $(button).next()
        let number = Number(elem.text())
        if ((number - 1) < 1) {
            number = 1
        } else {
            number = number - 1
        }
        elem.text(number)
        let itemPriceInput = $(button).parent().parent().prev().find('.item-price-input')
        let itemPrice = $(button).parent().parent().prev().find('.item-price')
        let price = Number($(button).parent().parent().prev().find('.item-price-constant').text())
        itemPrice.text(price * number)
        itemPriceInput.val(price * number)
        totalPrice()
    }

    function plusButton(button) {
        let elem = $(button).prev()
        let number = Number(elem.text())
        if ((number + 1) > 10) {
            number = 10
        } else {
            number = number + 1
        }
        elem.text(number)
        let itemPriceInput = $(button).parent().parent().prev().find('.item-price-input')
        let itemPrice = $(button).parent().parent().prev().find('.item-price')
        let price = Number($(button).parent().parent().prev().find('.item-price-constant').text())
        itemPrice.text(price * number)
        itemPriceInput.val(price * number)
        totalPrice()
    }

    function trashButton(button) {
        $(button).parent().parent().parent().remove()
        totalPrice()
    }

    function totalPrice() {
        let prices = $('.item-price')
        prices = prices.slice(0, prices.length - 1)
        let total = 0
        for (let price of prices) {
            total = total + Number($(price).text())
        }
        $('#modal-total').text(total)
    }

    function sendComment(elem) {
        let form = $(elem).parent()
        console.log($(form).find('#contact-name').val())
        console.log($(form).find('#contact-text').val())
        console.log($(form).find('#contact-email').val())
        $.ajax({
                url: '{{ url_for('comment') }}',
                type: 'POST',
                data: {
                    'name': $(form).find('#contact-name').val(),
                    'comment': $(form).find('#contact-text').val(),
                    'email': $(form).find('#contact-email').val(),
                },
                success: function (response, status, xmlHttpRequest) {
                    console.log("Response Received")
                    alert(response)
                },
                error: function () {
                    console.log('Error!')
                }
            }
        )
    }
</script>